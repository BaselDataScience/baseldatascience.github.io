<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Reinhold Koch">
<meta name="dcterms.date" content="2023-10-30">

<title>BaselDataScience - Nationalratswahlen Basel 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../baseldatasciencelogo.jpeg);
background-size: cover;
      }
</style>

<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="BaselDataScience - Nationalratswahlen Basel 2023">
<meta property="og:description" content="">
<meta property="og:image" content="https://BaselDataScience.github.io/baseldatascience.github.io/posts/nationalratswahlen_2023_files/figure-html/age_distribution-1.png">
<meta property="og:site-name" content="BaselDataScience">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">BaselDataScience</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://baseldatascience.github.io" rel="" target=""><i class="bi bi-github" role="img" aria-label="github">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/12870553/" rel="" target=""><i class="bi bi-chat-right-text" role="img" aria-label="linkedIn">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Nationalratswahlen Basel 2023</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Reinhold Koch </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 30, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#nationalratswahlen-basel-2023" id="toc-nationalratswahlen-basel-2023" class="nav-link active" data-scroll-target="#nationalratswahlen-basel-2023">Nationalratswahlen Basel 2023</a>
  <ul class="collapse">
  <li><a href="#data-download" id="toc-data-download" class="nav-link" data-scroll-target="#data-download">Data download</a></li>
  <li><a href="#data-scrubbing" id="toc-data-scrubbing" class="nav-link" data-scroll-target="#data-scrubbing">Data scrubbing</a></li>
  </ul></li>
  <li><a href="#wahlkreise" id="toc-wahlkreise" class="nav-link" data-scroll-target="#wahlkreise">Wahlkreise</a>
  <ul class="collapse">
  <li><a href="#scrub-kanton" id="toc-scrub-kanton" class="nav-link" data-scroll-target="#scrub-kanton">scrub kanton</a></li>
  <li><a href="#excursion-distribution-of-candidate-ages" id="toc-excursion-distribution-of-candidate-ages" class="nav-link" data-scroll-target="#excursion-distribution-of-candidate-ages">excursion: distribution of candidate ages</a></li>
  </ul></li>
  <li><a href="#candidate-votes" id="toc-candidate-votes" class="nav-link" data-scroll-target="#candidate-votes">candidate votes</a></li>
  <li><a href="#listen-and-listenverbindungen" id="toc-listen-and-listenverbindungen" class="nav-link" data-scroll-target="#listen-and-listenverbindungen">Listen and Listenverbindungen</a>
  <ul class="collapse">
  <li><a href="#tree-structure-of-listenverbindungen" id="toc-tree-structure-of-listenverbindungen" class="nav-link" data-scroll-target="#tree-structure-of-listenverbindungen">tree structure of Listenverbindungen</a>
  <ul class="collapse">
  <li><a href="#candidates-per-hauptlistenverbindung" id="toc-candidates-per-hauptlistenverbindung" class="nav-link" data-scroll-target="#candidates-per-hauptlistenverbindung">candidates per Hauptlistenverbindung</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#top-level-votes" id="toc-top-level-votes" class="nav-link" data-scroll-target="#top-level-votes">top level votes</a>
  <ul class="collapse">
  <li><a href="#seats-per-hauptlistenverbindung" id="toc-seats-per-hauptlistenverbindung" class="nav-link" data-scroll-target="#seats-per-hauptlistenverbindung">seats per Hauptlistenverbindung</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="nationalratswahlen-basel-2023" class="level2">
<h2 class="anchored" data-anchor-id="nationalratswahlen-basel-2023">Nationalratswahlen Basel 2023</h2>
<p>On 2023-10-22 Nationalratswahlen took place in Switzerland, so also in Basel. The results can be seen on https://www.staatskanzlei.bs.ch/politische-rechte/wahlen-abstimmungen/wahlen-2023.html including the protocols how the 4 Basel seats in the Nationalrat were assigned.</p>
<p>A nice open government data service are the downloadable vote counts from a link on this page. As the Swiss election system is far from simple I thought it informativ to look into the vote counts and see whether I could compute the election results myself and see whether I arrive at the same results as the Basel Staatskanzlei.</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/initialise_4d53a5559e9aaee216782f05a68ae57e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.tree)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(philentropy)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>distinctness <span class="ot">&lt;-</span> <span class="cf">function</span>(x) philentropy<span class="sc">::</span><span class="fu">H</span>(<span class="fu">table</span>(x, <span class="at">useNA =</span> <span class="st">'ifany'</span>)<span class="sc">/</span><span class="fu">length</span>(x)) <span class="sc">/</span> <span class="fu">log</span>(<span class="fu">length</span>(x), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="data-download" class="level3">
<h3 class="anchored" data-anchor-id="data-download">Data download</h3>
<p>If not already in the active R session, I download the Excel file containing the vote counts. Excel file, because it is type safe (“01” != 1) and provides a familiar table format.</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/download_db6f50f5f78b4bd8e799d0130f149f9b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data if not already present</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">'dat0'</span>)) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(<span class="st">'https://data.bs.ch/api/explore/v2.1/catalog/datasets/100281/exports/xlsx'</span>, tf <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">'.xlsx'</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  dat0 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(tf)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 610  90</code></pre>
</div>
</div>
</section>
<section id="data-scrubbing" class="level3">
<h3 class="anchored" data-anchor-id="data-scrubbing">Data scrubbing</h3>
<p>This is a pretty wide data table with 90 columns. A description of the columns can be found as “Datensatzschema” in the tab “Information” on https://data.bs.ch/explore/dataset/100281/information. The first columns contain constant values, like <strong>wahlbezeichnung</strong> “Wahl von vier Mitgliedern des Nationalrates”.</p>
<p>To find and remove such columns I employ the entropy of a column’s values. The <strong>distinctness()</strong> function defined above returns <strong>0</strong> for columns with constant values and <strong>1</strong> for columns that have a different value for each row in the table (row identifying columns).</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/scrub_bb885fdc0783dbda12092f764e94881f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># determine constant columns, move them to "general" dataframe</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>entropy0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(dat0, distinctness)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>general <span class="ot">&lt;-</span> <span class="fu">unique</span>(dat0[,<span class="fu">names</span>(entropy0[entropy0<span class="sc">==</span><span class="dv">0</span>])])</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>general</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["wahlbezeichnung"],"name":[1],"type":["chr"],"align":["left"]},{"label":["amtsdauer"],"name":[2],"type":["chr"],"align":["left"]},{"label":["wahltermin"],"name":[3],"type":["chr"],"align":["left"]},{"label":["anzahl_sitze"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["ungestempelte_wahlzettel"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"Wahl von vier Mitgliedern des Nationalrates","2":"2023-2027","3":"2023-10-22","4":"4","5":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> dat0[, <span class="fu">setdiff</span>(<span class="fu">names</span>(dat0), <span class="fu">names</span>(general))]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 610  85</code></pre>
</div>
</div>
</section>
</section>
<section id="wahlkreise" class="level2">
<h2 class="anchored" data-anchor-id="wahlkreise">Wahlkreise</h2>
<p>Among the remaining 85 columns there are 3 that identify Wahlkreise. I am not interested in the individual Wahlkreise (electoral district), but in the “Kanton Basel-Stadt”. So I split dat1 accordingly and concentrate on this pseudo Wahlkreis.</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/wahlkreise_45bf010898a5ccf3dbd5651ee0c61a2b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## find right Wahlkreis for Kanton</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat1<span class="sc">$</span>wahlkreisbezeichnung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  Auslandschweizer Gemeinde Bettingen    Gemeinde Riehen Kanton Basel-Stadt        Stadt Basel 
               122                122                122                122                122 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split dat1 by Wahlkreise</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>wahlkreise <span class="ot">&lt;-</span> <span class="fu">split</span>(dat1, dat1<span class="sc">$</span>wahlkreisbezeichnung)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># concentrate on Kanton</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>kanton0 <span class="ot">&lt;-</span> wahlkreise[[<span class="st">'Kanton Basel-Stadt'</span>]]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(kanton0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 122  85</code></pre>
</div>
</div>
<section id="scrub-kanton" class="level3">
<h3 class="anchored" data-anchor-id="scrub-kanton">scrub kanton</h3>
<p>There are a number of constant columns in the kanton data table. Like with the original data table I move them out to a separate table.</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/scrub_kanton_9639784f3970ade73133a494f9152a1b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>entropy_kanton <span class="ot">&lt;-</span> <span class="fu">sapply</span>(kanton0, distinctness)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>kanton_general <span class="ot">&lt;-</span> <span class="fu">unique</span>(kanton0[,<span class="fu">names</span>(entropy_kanton[entropy_kanton<span class="sc">==</span><span class="dv">0</span>])])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>kanton <span class="ot">&lt;-</span> kanton0[, <span class="fu">setdiff</span>(<span class="fu">names</span>(kanton0), <span class="fu">names</span>(kanton_general))]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(kanton)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 122  67</code></pre>
</div>
</div>
<p>The entropy shows that the candidates’ name and its equivalents kandidaten_nr and personen_id uniquely determine a single row in the kanton table.</p>
</section>
<section id="excursion-distribution-of-candidate-ages" class="level3">
<h3 class="anchored" data-anchor-id="excursion-distribution-of-candidate-ages">excursion: distribution of candidate ages</h3>
<p>Just for fun let us have a look at the distribution of the candidates’ ages:</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/age_distribution_55241fdf55804471703971b8e03b7e13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## age distribution of candidates</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>age_distr <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">dataspec=</span><span class="cn">NULL</span>) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(dat<span class="sc">$</span>alter_am_jahresende_2023, <span class="at">freq =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">'Altersverteilung der Kandidaten'</span>, dataspec), <span class="at">xlab =</span> <span class="st">'Kandidatenalter'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">90</span>,<span class="dv">5</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">density</span>(dat<span class="sc">$</span>alter_am_jahresende_2023, <span class="at">adjust=</span>.<span class="dv">5</span>), <span class="at">col=</span><span class="st">'blue'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">density</span>(dat<span class="sc">$</span>alter_am_jahresende_2023), <span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">age_distr</span>(kanton)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="nationalratswahlen_2023_files/figure-html/age_distribution-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by gender</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">age_distr</span>(<span class="fu">subset</span>(kanton, geschlecht<span class="sc">==</span><span class="st">'F'</span>), <span class="st">'weiblich'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">age_distr</span>(<span class="fu">subset</span>(kanton, geschlecht<span class="sc">==</span><span class="st">'M'</span>), <span class="st">'männlich'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="nationalratswahlen_2023_files/figure-html/age_distribution-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="candidate-votes" class="level2">
<h2 class="anchored" data-anchor-id="candidate-votes">candidate votes</h2>
<p>Back to the main topic: number of votes. How many did each candidate collect?</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/votes_b3c10aa058baee53258ca2125f039707">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>kanton <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(kandidaten_nr, parteikurzbezeichnung, bisher, gewahlt, ganzer_name, stimmen_total_aus_wahlzettel, hlv_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(stimmen_total_aus_wahlzettel))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["kandidaten_nr"],"name":[1],"type":["chr"],"align":["left"]},{"label":["parteikurzbezeichnung"],"name":[2],"type":["chr"],"align":["left"]},{"label":["bisher"],"name":[3],"type":["chr"],"align":["left"]},{"label":["gewahlt"],"name":[4],"type":["chr"],"align":["left"]},{"label":["ganzer_name"],"name":[5],"type":["chr"],"align":["left"]},{"label":["stimmen_total_aus_wahlzettel"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["hlv_nr"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"0501","2":"SP","3":"bisher","4":"Gewählt","5":"Wyss, Sarah","6":"22032","7":"2"},{"1":"0502","2":"SP","3":"bisher","4":"nicht gewählt","5":"Atici, Mustafa","6":"20138","7":"2"},{"1":"0801","2":"BGB","3":"bisher","4":"Gewählt","5":"Arslan, Sibel","6":"14239","7":"2"},{"1":"0503","2":"SP","3":"NA","4":"nicht gewählt","5":"Mathys, Lisa","6":"12995","7":"2"},{"1":"0504","2":"SP","3":"NA","4":"nicht gewählt","5":"von Wartburg, Christian (Guschti)","6":"10800","7":"2"},{"1":"0301","2":"LDP","3":"bisher","4":"Gewählt","5":"von Falkenstein, Patricia","6":"9792","7":"1"},{"1":"1204","2":"SVP","3":"NA","4":"nicht gewählt","5":"Thüring, Joël","6":"8242","7":"3"},{"1":"0802","2":"BGB","3":"NA","4":"nicht gewählt","5":"Vergeat, Jo","6":"8084","7":"2"},{"1":"1203","2":"SVP","3":"NA","4":"nicht gewählt","5":"Suter, Stefan","6":"7366","7":"3"},{"1":"1001","2":"GLP","3":"bisher","4":"Gewählt","5":"Christ, Katja","6":"6655","7":"1"},{"1":"0104","2":"FDP","3":"NA","4":"nicht gewählt","5":"Dürr, Baschi","6":"6220","7":"1"},{"1":"1201","2":"SVP","3":"NA","4":"nicht gewählt","5":"Block, Laetitia","6":"6009","7":"3"},{"1":"1202","2":"SVP","3":"NA","4":"nicht gewählt","5":"Stumpf Rutschmann, Daniela","6":"5680","7":"3"},{"1":"0302","2":"LDP","3":"NA","4":"nicht gewählt","5":"Furlano, Raoul","6":"4958","7":"1"},{"1":"0803","2":"BGB","3":"NA","4":"nicht gewählt","5":"Goepfert, Nicola","6":"4766","7":"2"},{"1":"0804","2":"BGB","3":"NA","4":"nicht gewählt","5":"Hoppler, Laurin","6":"3903","7":"2"},{"1":"0701","2":"Mitte","3":"NA","4":"nicht gewählt","5":"Herter, Balz","6":"3775","7":"1"},{"1":"0303","2":"LDP","3":"NA","4":"nicht gewählt","5":"Hug, Michael","6":"3550","7":"1"},{"1":"0304","2":"LDP","3":"NA","4":"nicht gewählt","5":"Isler-Christ, Lydia","6":"3233","7":"1"},{"1":"1003","2":"GLP","3":"NA","4":"nicht gewählt","5":"Baumgartner, Claudia","6":"2605","7":"1"},{"1":"1002","2":"GLP","3":"NA","4":"nicht gewählt","5":"Pekerman, Bülent","6":"2520","7":"1"},{"1":"0103","2":"FDP","3":"NA","4":"nicht gewählt","5":"Biland, Eva","6":"2518","7":"1"},{"1":"0102","2":"FDP","3":"NA","4":"nicht gewählt","5":"Barth, Johannes","6":"2446","7":"1"},{"1":"0704","2":"Mitte","3":"NA","4":"nicht gewählt","5":"Huber, Patrick","6":"2317","7":"1"},{"1":"0703","2":"Mitte","3":"NA","4":"nicht gewählt","5":"Conti, Tiziana","6":"2241","7":"1"},{"1":"0702","2":"Mitte","3":"NA","4":"nicht gewählt","5":"Knellwolf, Andrea","6":"2195","7":"1"},{"1":"1004","2":"GLP","3":"NA","4":"nicht gewählt","5":"Sieber, Johannes","6":"2160","7":"1"},{"1":"0101","2":"FDP","3":"NA","4":"nicht gewählt","5":"Alù, Tamara","6":"2004","7":"1"},{"1":"0401","2":"EVP","3":"NA","4":"nicht gewählt","5":"Gysin, Brigitte","6":"1370","7":"1"},{"1":"0404","2":"EVP","3":"NA","4":"nicht gewählt","5":"Widmer-Huber, Thomas","6":"1252","7":"1"},{"1":"2801","2":"MV","3":"NA","4":"nicht gewählt","5":"Della Giacoma, Mario","6":"1198","7":"NA"},{"1":"0402","2":"EVP","3":"NA","4":"nicht gewählt","5":"Hochuli, Christoph","6":"1178","7":"1"},{"1":"0403","2":"EVP","3":"NA","4":"nicht gewählt","5":"Stankowski, Rebecca","6":"1099","7":"1"},{"1":"1703","2":"Basta-rm","3":"NA","4":"nicht gewählt","5":"Zürcher, Tonja","6":"1066","7":"2"},{"1":"1101","2":"PdA","3":"NA","4":"nicht gewählt","5":"Genitsch Gratwohl, Vera","6":"1014","7":"NA"},{"1":"1401","2":"VA","3":"NA","4":"nicht gewählt","5":"Weber, Eric","6":"908","7":"NA"},{"1":"2103","2":"jgb","3":"NA","4":"nicht gewählt","5":"Girard, Fina","6":"847","7":"2"},{"1":"1701","2":"Basta-rm","3":"NA","4":"nicht gewählt","5":"Deiss, Sina","6":"810","7":"2"},{"1":"1402","2":"VA","3":"NA","4":"nicht gewählt","5":"Wächter, Sascha","6":"729","7":"NA"},{"1":"1704","2":"Basta-rm","3":"NA","4":"nicht gewählt","5":"Bolliger, Oliver","6":"708","7":"2"},{"1":"1702","2":"Basta-rm","3":"NA","4":"nicht gewählt","5":"Stier, Franziska","6":"692","7":"2"},{"1":"2503","2":"JGLP","3":"NA","4":"nicht gewählt","5":"Rohner, Tim","6":"627","7":"1"},{"1":"2404","2":"SP60+","3":"NA","4":"nicht gewählt","5":"Burckhardt, Leonhard","6":"624","7":"2"},{"1":"2102","2":"jgb","3":"NA","4":"nicht gewählt","5":"Feurer, Anouk","6":"617","7":"2"},{"1":"2504","2":"JGLP","3":"NA","4":"nicht gewählt","5":"Bucher, Milena","6":"588","7":"1"},{"1":"2403","2":"SP60+","3":"NA","4":"nicht gewählt","5":"Baerlocher, Thomas","6":"571","7":"2"},{"1":"3202","2":"GLP-K-U","3":"NA","4":"nicht gewählt","5":"Bollack, Lukas","6":"520","7":"1"},{"1":"2003","2":"JUSO","3":"NA","4":"nicht gewählt","5":"Russano, Nino","6":"519","7":"2"},{"1":"3601","2":"Mitte60+","3":"NA","4":"nicht gewählt","5":"Isler, Beatrice","6":"518","7":"1"},{"1":"0901","2":"EDU","3":"NA","4":"nicht gewählt","5":"Hirschi-Schiegg, Karin","6":"518","7":"3"},{"1":"2004","2":"JUSO","3":"NA","4":"nicht gewählt","5":"Schäfer, Maria Ioana","6":"515","7":"2"},{"1":"2701","2":"BastA-jA","3":"NA","4":"nicht gewählt","5":"Aelen, Marvin / Doa","6":"480","7":"2"},{"1":"2104","2":"jgb","3":"NA","4":"nicht gewählt","5":"Schmidlin, Aurel","6":"468","7":"2"},{"1":"2001","2":"JUSO","3":"NA","4":"nicht gewählt","5":"Haefeli, Ella","6":"466","7":"2"},{"1":"1102","2":"PdA","3":"NA","4":"nicht gewählt","5":"Goldschmidt, Matthias","6":"466","7":"NA"},{"1":"2802","2":"MV","3":"NA","4":"nicht gewählt","5":"Studinger, Maria","6":"465","7":"NA"},{"1":"2803","2":"MV","3":"NA","4":"nicht gewählt","5":"Studinger, Leo","6":"453","7":"NA"},{"1":"1103","2":"PdA","3":"NA","4":"nicht gewählt","5":"Hofer, Stefan","6":"448","7":"NA"},{"1":"2401","2":"SP60+","3":"NA","4":"nicht gewählt","5":"König-Lüdin, Dominique","6":"435","7":"2"},{"1":"3604","2":"Mitte60+","3":"NA","4":"nicht gewählt","5":"Wehrle, Stefan","6":"434","7":"1"},{"1":"3201","2":"GLP-K-U","3":"NA","4":"nicht gewählt","5":"Kühne, Brigitte","6":"430","7":"1"},{"1":"2002","2":"JUSO","3":"NA","4":"nicht gewählt","5":"Portmann, David","6":"422","7":"2"},{"1":"2101","2":"jgb","3":"NA","4":"nicht gewählt","5":"Bürge, Clara","6":"418","7":"2"},{"1":"2702","2":"BastA-jA","3":"NA","4":"nicht gewählt","5":"Hunter, Xenia","6":"416","7":"2"},{"1":"2603","2":"FDP+","3":"NA","4":"nicht gewählt","5":"Haller, Christophe","6":"410","7":"1"},{"1":"3501","2":"GLP-R-E","3":"NA","4":"nicht gewählt","5":"Rechsteiner, Niggi","6":"400","7":"1"},{"1":"2704","2":"BastA-jA","3":"NA","4":"nicht gewählt","5":"Zimmermann, Mia","6":"385","7":"2"},{"1":"2201","2":"JMITTE","3":"NA","4":"nicht gewählt","5":"Brenneis-Hobi, Manuela","6":"382","7":"1"},{"1":"2402","2":"SP60+","3":"NA","4":"nicht gewählt","5":"Verrey, Etiennette J.","6":"382","7":"2"},{"1":"3603","2":"Mitte60+","3":"NA","4":"nicht gewählt","5":"Lötscher-Steiger, Bruno","6":"371","7":"1"},{"1":"3203","2":"GLP-K-U","3":"NA","4":"nicht gewählt","5":"Lienhard, Nadine Michèle","6":"368","7":"1"},{"1":"2502","2":"JGLP","3":"NA","4":"nicht gewählt","5":"Kuhn, Jessica","6":"354","7":"1"},{"1":"2703","2":"BastA-jA","3":"NA","4":"nicht gewählt","5":"Krneta, Kasimir","6":"333","7":"2"},{"1":"2604","2":"FDP+","3":"NA","4":"nicht gewählt","5":"Jenny, David","6":"324","7":"1"},{"1":"3103","2":"SVP60+","3":"NA","4":"nicht gewählt","5":"Schaller, Beat K.","6":"320","7":"3"},{"1":"3303","2":"GLP-B","3":"NA","4":"nicht gewählt","5":"Staehelin, Christine","6":"309","7":"1"},{"1":"3004","2":"SVP-Gew","3":"NA","4":"nicht gewählt","5":"Schweizer-Hoffmann, Jenny","6":"308","7":"3"},{"1":"3302","2":"GLP-B","3":"NA","4":"nicht gewählt","5":"Mischke, Jürgen","6":"302","7":"1"},{"1":"3602","2":"Mitte60+","3":"NA","4":"nicht gewählt","5":"Strahm, Andrea","6":"301","7":"1"},{"1":"2601","2":"FDP+","3":"NA","4":"nicht gewählt","5":"Schweizer, Silvia","6":"290","7":"1"},{"1":"3402","2":"LDP-Gew","3":"NA","4":"nicht gewählt","5":"Hettich, Daniel","6":"288","7":"1"},{"1":"2501","2":"JGLP","3":"NA","4":"nicht gewählt","5":"Neuenschwander, Nicolas","6":"280","7":"1"},{"1":"3002","2":"SVP-Gew","3":"NA","4":"nicht gewählt","5":"Omlin, Florian","6":"279","7":"3"},{"1":"1802","2":"JSVP","3":"NA","4":"nicht gewählt","5":"Hablützel, Demi","6":"276","7":"3"},{"1":"3204","2":"GLP-K-U","3":"NA","4":"nicht gewählt","5":"Vicentini, Daniel","6":"274","7":"1"},{"1":"3003","2":"SVP-Gew","3":"NA","4":"nicht gewählt","5":"Schmid, Daniel","6":"253","7":"3"},{"1":"3101","2":"SVP60+","3":"NA","4":"nicht gewählt","5":"Herzig-Jonasch, Oskar","6":"253","7":"3"},{"1":"0601","2":"JFDP","3":"NA","4":"nicht gewählt","5":"Lüthy, Jonas","6":"252","7":"1"},{"1":"2602","2":"FDP+","3":"NA","4":"nicht gewählt","5":"Bucher, Erich","6":"236","7":"1"},{"1":"2304","2":"JLB","3":"NA","4":"nicht gewählt","5":"von Falkenstein, Benjamin","6":"231","7":"1"},{"1":"1803","2":"JSVP","3":"NA","4":"nicht gewählt","5":"Jacomet, Lucas","6":"230","7":"3"},{"1":"1801","2":"JSVP","3":"NA","4":"nicht gewählt","5":"Bottoni, Diandra","6":"227","7":"3"},{"1":"0902","2":"EDU","3":"NA","4":"nicht gewählt","5":"Messina, Luzian","6":"222","7":"3"},{"1":"3304","2":"GLP-B","3":"NA","4":"nicht gewählt","5":"Tasoglu, Javuz","6":"216","7":"1"},{"1":"3001","2":"SVP-Gew","3":"NA","4":"nicht gewählt","5":"Nikolic, Bozidar","6":"208","7":"3"},{"1":"0604","2":"JFDP","3":"NA","4":"nicht gewählt","5":"Mumenthaler, Lionel","6":"207","7":"1"},{"1":"3301","2":"GLP-B","3":"NA","4":"nicht gewählt","5":"Bothe-Wenk, Sandra","6":"206","7":"1"},{"1":"3102","2":"SVP60+","3":"NA","4":"nicht gewählt","5":"Lindner, Roland","6":"203","7":"3"},{"1":"3401","2":"LDP-Gew","3":"NA","4":"nicht gewählt","5":"Borer, Patrick","6":"196","7":"1"},{"1":"0903","2":"EDU","3":"NA","4":"nicht gewählt","5":"Schneider, Martin","6":"195","7":"3"},{"1":"1804","2":"JSVP","3":"NA","4":"nicht gewählt","5":"Lutz, Joshua","6":"183","7":"3"},{"1":"3502","2":"GLP-R-E","3":"NA","4":"nicht gewählt","5":"Wallace, Denise","6":"171","7":"1"},{"1":"3503","2":"GLP-R-E","3":"NA","4":"nicht gewählt","5":"Francis, Jessica","6":"163","7":"1"},{"1":"3504","2":"GLP-R-E","3":"NA","4":"nicht gewählt","5":"Fernandez, Laura","6":"161","7":"1"},{"1":"3701","2":"GLP-KMU","3":"NA","4":"nicht gewählt","5":"Christ, Tobias","6":"154","7":"1"},{"1":"3804","2":"GLP-I","3":"NA","4":"nicht gewählt","5":"Häni, Thomas","6":"152","7":"1"},{"1":"2203","2":"JMITTE","3":"NA","4":"nicht gewählt","5":"Murray, Sara","6":"145","7":"1"},{"1":"0603","2":"JFDP","3":"NA","4":"nicht gewählt","5":"Flad, Eugénie","6":"140","7":"1"},{"1":"2202","2":"JMITTE","3":"NA","4":"nicht gewählt","5":"Natoli, Marco","6":"139","7":"1"},{"1":"2301","2":"JLB","3":"NA","4":"nicht gewählt","5":"Eberhardt, Josephine","6":"135","7":"1"},{"1":"0602","2":"JFDP","3":"NA","4":"nicht gewählt","5":"Jung, Isabel","6":"133","7":"1"},{"1":"2204","2":"JMITTE","3":"NA","4":"nicht gewählt","5":"Winkler, Kilian","6":"128","7":"1"},{"1":"3801","2":"GLP-I","3":"NA","4":"nicht gewählt","5":"Kaufmann, Wanja","6":"125","7":"1"},{"1":"2302","2":"JLB","3":"NA","4":"nicht gewählt","5":"Laissue, Marvin","6":"113","7":"1"},{"1":"3403","2":"LDP-Gew","3":"NA","4":"nicht gewählt","5":"Spillmann, Daniela","6":"103","7":"1"},{"1":"3404","2":"LDP-Gew","3":"NA","4":"nicht gewählt","5":"Thüring, Yvette","6":"100","7":"1"},{"1":"3704","2":"GLP-KMU","3":"NA","4":"nicht gewählt","5":"Löw, Michael","6":"88","7":"1"},{"1":"3802","2":"GLP-I","3":"NA","4":"nicht gewählt","5":"Wilhelmi, Thomas","6":"87","7":"1"},{"1":"2303","2":"JLB","3":"NA","4":"nicht gewählt","5":"Marckwordt, Joshua","6":"83","7":"1"},{"1":"3702","2":"GLP-KMU","3":"NA","4":"nicht gewählt","5":"Meyer, Serge","6":"79","7":"1"},{"1":"3703","2":"GLP-KMU","3":"NA","4":"nicht gewählt","5":"Mathis-Stich, Sonja","6":"79","7":"1"},{"1":"3803","2":"GLP-I","3":"NA","4":"nicht gewählt","5":"Frey Brenner, Andrea Johanna","6":"55","7":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Naively one could imagine the seats go to the 4 candidates with the most votes - but that ignores the intention to try to assign seats in a fashion that mirrors the votes for lists; here in Switzerland the most decisive seat distribution factor are the votes for a “Listenverbindung”.</p>
</section>
<section id="listen-and-listenverbindungen" class="level1">
<h1>Listen and Listenverbindungen</h1>
<p>We have 32 lists, most of them sent in 4 candidates:</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/lists_37525e96e5896dbecb2db503859c1caf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(kanton<span class="sc">$</span>listen_nr, <span class="at">useNA =</span> <span class="st">'ifany'</span>)  <span class="co"># 32 lists run</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
01 03 04 05 06 07 08 09 10 11 12 14 17 18 20 21 22 23 24 25 26 27 28 30 31 32 33 34 35 36 37 38 
 4  4  4  4  4  4  4  3  4  3  4  2  4  4  4  4  4  4  4  4  4  4  3  4  3  4  4  4  4  4  4  4 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(lists <span class="ot">&lt;-</span> kanton <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(listen_nr, hlv_nr, ulv_nr, partei_id, parteikurzbezeichnung, parteibezeichnung) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">listenstimmen=</span><span class="fu">mean</span>(kandidatenstimmen_unveranderte_wahlzettel<span class="sc">+</span>kandidatenstimmen_veranderte_wahlzettel<span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                zusatzstimmen_unveranderte_wahlzettel<span class="sc">+</span>zusatzstimmen_veranderte_wahlzettel),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">kandidates=</span><span class="fu">n</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'listen_nr', 'hlv_nr', 'ulv_nr', 'partei_id',
'parteikurzbezeichnung'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["listen_nr"],"name":[1],"type":["chr"],"align":["left"]},{"label":["hlv_nr"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ulv_nr"],"name":[3],"type":["chr"],"align":["left"]},{"label":["partei_id"],"name":[4],"type":["chr"],"align":["left"]},{"label":["parteikurzbezeichnung"],"name":[5],"type":["chr"],"align":["left"]},{"label":["parteibezeichnung"],"name":[6],"type":["chr"],"align":["left"]},{"label":["listenstimmen"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["kandidates"],"name":[8],"type":["int"],"align":["right"]}],"data":[{"1":"01","2":"1","3":"1","4":"8","5":"FDP","6":"FDP.Die Liberalen Basel-Stadt","7":"13489","8":"4"},{"1":"03","2":"1","3":"2","4":"15","5":"LDP","6":"LDP Liberal-Demokratische Partei Basel-Stadt","7":"21948","8":"4"},{"1":"04","2":"1","3":"NA","4":"4","5":"EVP","6":"Evangelische Volkspartei Basel-Stadt (EVP)","7":"4946","8":"4"},{"1":"05","2":"2","3":"3","4":"17","5":"SP","6":"Sozialdemokratische Partei Basel-Stadt (SP)","7":"67502","8":"4"},{"1":"06","2":"1","3":"1","4":"18","5":"JFDP","6":"Jungfreisinnige Basel-Stadt","7":"742","8":"4"},{"1":"07","2":"1","3":"4","4":"3","5":"Mitte","6":"Die Mitte Basel-Stadt","7":"10674","8":"4"},{"1":"08","2":"2","3":"5","4":"3","5":"BGB","6":"Bündnis GRÜNE BastA!","7":"31227","8":"4"},{"1":"09","2":"3","3":"NA","4":"21","5":"EDU","6":"Eidgenössisch Demokratische Union Basel-Stadt (EDU)","7":"946","8":"3"},{"1":"10","2":"1","3":"6","4":"22","5":"GLP","6":"GLP - Grünliberale Partei Basel-Stadt","7":"14280","8":"4"},{"1":"11","2":"NA","3":"NA","4":"9","5":"PdA","6":"Partei der Arbeit (PdA) Basel","7":"1933","8":"3"},{"1":"12","2":"3","3":"7","4":"67","5":"SVP","6":"Schweizerische Volkspartei Basel-Stadt (SVP)","7":"27740","8":"4"},{"1":"14","2":"NA","3":"NA","4":"44","5":"VA","6":"Volks-Aktion gegen zuviele Ausländer und Asylanten in unserer Heimat (VA) - Liste Ausländerstopp","7":"1690","8":"2"},{"1":"17","2":"2","3":"5","4":"44","5":"Basta-rm","6":"Bündnis: BastA! radikal menschlich","7":"3285","8":"4"},{"1":"18","2":"3","3":"7","4":"26","5":"JSVP","6":"Junge SVP Basel-Stadt (JSVP)","7":"938","8":"4"},{"1":"20","2":"2","3":"3","4":"27","5":"JUSO","6":"JUSO Basel-Stadt","7":"1925","8":"4"},{"1":"21","2":"2","3":"5","4":"28","5":"jgb","6":"junges grünes bündnis","7":"2356","8":"4"},{"1":"22","2":"1","3":"4","4":"28","5":"JMITTE","6":"Die Junge Mitte Basel-Stadt","7":"809","8":"4"},{"1":"23","2":"1","3":"2","4":"46","5":"JLB","6":"Jungliberale","7":"569","8":"4"},{"1":"24","2":"2","3":"3","4":"46","5":"SP60+","6":"Sozialdemokratische Partei Basel-Stadt 60+ (SP 60+)","7":"2024","8":"4"},{"1":"25","2":"1","3":"6","4":"47","5":"JGLP","6":"GLP - Junge Grünliberale","7":"1859","8":"4"},{"1":"26","2":"1","3":"1","4":"47","5":"FDP+","6":"FDP PLUS","7":"1285","8":"4"},{"1":"27","2":"2","3":"5","4":"47","5":"BastA-jA","6":"Bündnis: BastA! junge Alternative!","7":"1615","8":"4"},{"1":"28","2":"NA","3":"NA","4":"47","5":"MV","6":"MASS-VOLL! Bewegung für Freiheit, Souveränität und Grundrechte","7":"2163","8":"3"},{"1":"30","2":"3","3":"7","4":"47","5":"SVP-Gew","6":"SVP Gewerbe-Liste","7":"1054","8":"4"},{"1":"31","2":"3","3":"7","4":"13","5":"SVP60+","6":"SVP 60+","7":"922","8":"3"},{"1":"32","2":"1","3":"6","4":"13","5":"GLP-K-U","6":"GLP - Klima & Umwelt","7":"1599","8":"4"},{"1":"33","2":"1","3":"6","4":"13","5":"GLP-B","6":"GLP - Bildung","7":"1077","8":"4"},{"1":"34","2":"1","3":"2","4":"49","5":"LDP-Gew","6":"Gewerbe LDP","7":"701","8":"4"},{"1":"35","2":"1","3":"6","4":"49","5":"GLP-R-E","6":"GLP - Regio & Europa","7":"904","8":"4"},{"1":"36","2":"1","3":"4","4":"49","5":"Mitte60+","6":"Die Mitte Basel-Stadt 60+","7":"1648","8":"4"},{"1":"37","2":"1","3":"6","4":"49","5":"GLP-KMU","6":"GLP - KMU","7":"400","8":"4"},{"1":"38","2":"1","3":"6","4":"49","5":"GLP-I","6":"GLP - International","7":"424","8":"4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Looking at the distinctiveness of the columns in table <strong>lists</strong> we see:</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/list_distinct_ed46b64abc5355aee4ab1152189dbfb9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(lists, distinctness))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           kandidates                hlv_nr                ulv_nr             partei_id 
            0.1476127             0.3406070             0.5857458             0.7751614 
            listen_nr parteikurzbezeichnung     parteibezeichnung         listenstimmen 
            1.0000000             1.0000000             1.0000000             1.0000000 </code></pre>
</div>
</div>
<p>listen_nr, parteikurzbezeichnung, and parteibezeichnung all identify uniquely the lists. What partei_id is supposed to designate escapes me, the “Datensatzschema” from https://data.bs.ch/explore/dataset/100281/information does not help.</p>
<section id="tree-structure-of-listenverbindungen" class="level2">
<h2 class="anchored" data-anchor-id="tree-structure-of-listenverbindungen">tree structure of Listenverbindungen</h2>
<p>There are Hauptlistenverbindungen and Unterlistenverbindungen, though these are not mandatory for lists, they generate a tree structure with 3 major blocks competing for 4 seats.</p>
<p>Analysis of a values in tree structures is not mainstream in R. I employ the package <strong>data.tree</strong> to do so and first need to construct another column in table <strong>lists</strong> that indicates the position in the tree:</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/listenverbindungen_878648b073389a7eee3cbef27084bd12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tree structure of the lists:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>lists<span class="sc">$</span>pathString <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">'basel'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">coalesce</span>(lists<span class="sc">$</span>hlv_nr, <span class="st">''</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">coalesce</span>(lists<span class="sc">$</span>ulv_nr, <span class="st">''</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                          lists<span class="sc">$</span>listen_nr,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sep =</span> <span class="st">'/'</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>zz <span class="ot">&lt;-</span> data.tree<span class="sc">::</span><span class="fu">as.Node</span>(lists)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(zz, <span class="st">'parteikurzbezeichnung'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        levelName parteikurzbezeichnung
1  basel                               
2   ¦--1                               
3   ¦   ¦--1                           
4   ¦   ¦   ¦--01                   FDP
5   ¦   ¦   ¦--06                  JFDP
6   ¦   ¦   °--26                  FDP+
7   ¦   ¦--2                           
8   ¦   ¦   ¦--03                   LDP
9   ¦   ¦   ¦--23                   JLB
10  ¦   ¦   °--34               LDP-Gew
11  ¦   ¦--04                       EVP
12  ¦   ¦--4                           
13  ¦   ¦   ¦--07                 Mitte
14  ¦   ¦   ¦--22                JMITTE
15  ¦   ¦   °--36              Mitte60+
16  ¦   °--6                           
17  ¦       ¦--10                   GLP
18  ¦       ¦--25                  JGLP
19  ¦       ¦--32               GLP-K-U
20  ¦       ¦--33                 GLP-B
21  ¦       ¦--35               GLP-R-E
22  ¦       ¦--37               GLP-KMU
23  ¦       °--38                 GLP-I
24  ¦--2                               
25  ¦   ¦--3                           
26  ¦   ¦   ¦--05                    SP
27  ¦   ¦   ¦--20                  JUSO
28  ¦   ¦   °--24                 SP60+
29  ¦   °--5                           
30  ¦       ¦--08                   BGB
31  ¦       ¦--17              Basta-rm
32  ¦       ¦--21                   jgb
33  ¦       °--27              BastA-jA
34  ¦--3                               
35  ¦   ¦--09                       EDU
36  ¦   °--7                           
37  ¦       ¦--12                   SVP
38  ¦       ¦--18                  JSVP
39  ¦       ¦--30               SVP-Gew
40  ¦       °--31                SVP60+
41  ¦--11                           PdA
42  ¦--14                            VA
43  °--28                            MV</code></pre>
</div>
</div>
<p>Three lists, PdA, VA, and MV, do not belong to any Listenverbindung. There are three Hauptlistenverbindungen:</p>
<ul>
<li>1 conservatives</li>
<li>2 moderate left</li>
<li>3 SVP</li>
</ul>
<p>among which the seats have to be distributed.</p>
<section id="candidates-per-hauptlistenverbindung" class="level3">
<h3 class="anchored" data-anchor-id="candidates-per-hauptlistenverbindung">candidates per Hauptlistenverbindung</h3>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/hlv_candidates_cd9016966c606d580af1660c7c6b6017">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of candidates per Hauptliste</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>zz<span class="sc">$</span><span class="fu">Do</span>( <span class="cf">function</span>(x) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>kandidaten_total <span class="ot">&lt;-</span> <span class="fu">Aggregate</span>(<span class="at">node =</span> x,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">attribute =</span> <span class="st">"kandidates"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">aggFun =</span> sum)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>data.tree<span class="sc">::</span><span class="fu">Get</span>(zz<span class="sc">$</span>children, <span class="st">'kandidaten_total'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> 1  2  3 11 14 28 
68 28 18  3  2  3 </code></pre>
</div>
</div>
<p>Extensive use of Listenverbindungen blows up the number of candidates; Hauptlistenverbindung 1 comes with 68 of these!</p>
</section>
</section>
</section>
<section id="top-level-votes" class="level1">
<h1>top level votes</h1>
<p>How many votes did the Hauptlistenverbindungen and the Einzellisten come up with?</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/hlv_votes_723dd8d979825a3deed6de58aefeda4f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## top-level votes</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>(hl_votes <span class="ot">&lt;-</span> <span class="fu">sort</span>(data.tree<span class="sc">::</span><span class="fu">Get</span>(zz<span class="sc">$</span>children, <span class="cf">function</span>(x) data.tree<span class="sc">::</span><span class="fu">Aggregate</span>(x, <span class="st">'listenstimmen'</span>, sum)), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     2      1      3     28     11     14 
109934  77354  31600   2163   1933   1690 </code></pre>
</div>
</div>
<section id="seats-per-hauptlistenverbindung" class="level2">
<h2 class="anchored" data-anchor-id="seats-per-hauptlistenverbindung">seats per Hauptlistenverbindung</h2>
<p>First step in seat distribution is to determine the quorum: the number of votes is divided by number of seats plus 1, then the next higher integer number is set as quorum. The integer part of the division of the votes of Hauptlistenverbindungen by the quorum indicates number of seats given to the Hauplistenverbindung.</p>
<p>It is possible that this first round does not distribute all seats - as is the case here. Votes of the Hauptlistenverbindung then are divided by 1 plus number of seats received and the remaining seat goes to the Hauptlistenverbindung with the highest quotient, here 1.</p>
<div class="cell" data-hash="nationalratswahlen_2023_cache/html/hlv_seats_9ff0f4f60ed530b7a38764c5c9cdb8f6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1st seat distribution</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>(quorum1 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">sum</span>(hl_votes)<span class="sc">/</span>(<span class="dv">4</span><span class="sc">+</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 44935</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(seats1 <span class="ot">&lt;-</span> <span class="fu">floor</span>(hl_votes<span class="sc">/</span>quorum1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> 2  1  3 28 11 14 
 2  1  0  0  0  0 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2nd seat distribution</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(hl_votes<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>seats1), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3       28       11       14 
38677.00 36644.67 31600.00  2163.00  1933.00  1690.00 </code></pre>
</div>
</div>
<p>Within the Hauptlistenverbindung the seats get distributed according to the same multi-step process first to Unterlistenverbindung, then Liste.</p>
<p>Detailed protocols of this process are provided by the Basel Staatskanzlei, see https://www.staatskanzlei.bs.ch/dam/jcr:302a9016-ef8c-41b8-888a-f6d7332ff1ab/Ausw_5a.pdf.</p>
<p>For a general picture what Swiss voters can do with their ballot paper, see https://www.srf.ch/news/schweiz/wahlhilfe/kumulieren-und-panaschieren-so-waehlt-man-mit-listen.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Nationalratswahlen Basel 2023"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Reinhold Koch"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-10-30"</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width =</span> <span class="dv">100</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">## Nationalratswahlen Basel 2023</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>On 2023-10-22 Nationalratswahlen took place in Switzerland, so also in Basel.</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>The results can be seen on https://www.staatskanzlei.bs.ch/politische-rechte/wahlen-abstimmungen/wahlen-2023.html</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>including the protocols how the 4 Basel seats in the Nationalrat were assigned.</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>A nice open government data service are the downloadable vote counts from a link on this page. </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>As the Swiss election system is far from simple I thought it informativ to look into the vote counts</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>and see whether I could compute the election results myself and see whether I arrive at the same results</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>as the Basel Staatskanzlei.</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r initialise}</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.tree)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(philentropy)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>distinctness <span class="ot">&lt;-</span> <span class="cf">function</span>(x) philentropy<span class="sc">::</span><span class="fu">H</span>(<span class="fu">table</span>(x, <span class="at">useNA =</span> <span class="st">'ifany'</span>)<span class="sc">/</span><span class="fu">length</span>(x)) <span class="sc">/</span> <span class="fu">log</span>(<span class="fu">length</span>(x), <span class="dv">2</span>)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data download</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>If not already in the active R session, I download the Excel file containing the vote counts.</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>Excel file, because it is type safe ("01" != 1) and provides a familiar table format.</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, download}</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data if not already present</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">'dat0'</span>)) {</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(<span class="st">'https://data.bs.ch/api/explore/v2.1/catalog/datasets/100281/exports/xlsx'</span>, tf <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">'.xlsx'</span>))</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>  dat0 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(tf)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat0)</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data scrubbing</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>This is a pretty wide data table with 90 columns.</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>A description of the columns can be found as "Datensatzschema" in the tab "Information" on</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>https://data.bs.ch/explore/dataset/100281/information.</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>The first columns contain constant values, like **wahlbezeichnung** "Wahl von vier Mitgliedern des Nationalrates".</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>To find and remove such columns I employ the entropy of a column's values. </span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>The **distinctness()** function defined above returns **0** for columns with constant values</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>and **1** for columns that have a different value for each row in the table (row identifying columns).</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r scrub}</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a><span class="co"># determine constant columns, move them to "general" dataframe</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>entropy0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(dat0, distinctness)</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>general <span class="ot">&lt;-</span> <span class="fu">unique</span>(dat0[,<span class="fu">names</span>(entropy0[entropy0<span class="sc">==</span><span class="dv">0</span>])])</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>general</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> dat0[, <span class="fu">setdiff</span>(<span class="fu">names</span>(dat0), <span class="fu">names</span>(general))]</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat1)</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a><span class="fu">## Wahlkreise</span></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>Among the remaining 85 columns there are 3 that identify Wahlkreise.</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>I am not interested in the individual Wahlkreise (electoral district), but in</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>the "Kanton Basel-Stadt".</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>So I split dat1 accordingly and concentrate on this pseudo Wahlkreis.</span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r wahlkreise}</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="do">## find right Wahlkreis for Kanton</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat1<span class="sc">$</span>wahlkreisbezeichnung)</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="co"># split dat1 by Wahlkreise</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>wahlkreise <span class="ot">&lt;-</span> <span class="fu">split</span>(dat1, dat1<span class="sc">$</span>wahlkreisbezeichnung)</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="co"># concentrate on Kanton</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>kanton0 <span class="ot">&lt;-</span> wahlkreise[[<span class="st">'Kanton Basel-Stadt'</span>]]</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(kanton0)</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="fu">### scrub kanton</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>There are a number of constant columns in the kanton data table.</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>Like with the original data table I move them out to a separate table.</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r scrub_kanton}</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>entropy_kanton <span class="ot">&lt;-</span> <span class="fu">sapply</span>(kanton0, distinctness)</span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>kanton_general <span class="ot">&lt;-</span> <span class="fu">unique</span>(kanton0[,<span class="fu">names</span>(entropy_kanton[entropy_kanton<span class="sc">==</span><span class="dv">0</span>])])</span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>kanton <span class="ot">&lt;-</span> kanton0[, <span class="fu">setdiff</span>(<span class="fu">names</span>(kanton0), <span class="fu">names</span>(kanton_general))]</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(kanton)</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>The entropy shows that the candidates' name and its equivalents kandidaten_nr and personen_id uniquely</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>determine a single row in the kanton table.</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="fu">### excursion: distribution of candidate ages</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>Just for fun let us have a look at the distribution of the candidates' ages:</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r age_distribution}</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a><span class="do">## age distribution of candidates</span></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>age_distr <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, <span class="at">dataspec=</span><span class="cn">NULL</span>) {</span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(dat<span class="sc">$</span>alter_am_jahresende_2023, <span class="at">freq =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">'Altersverteilung der Kandidaten'</span>, dataspec), <span class="at">xlab =</span> <span class="st">'Kandidatenalter'</span>,</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">90</span>,<span class="dv">5</span>))</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">density</span>(dat<span class="sc">$</span>alter_am_jahresende_2023, <span class="at">adjust=</span>.<span class="dv">5</span>), <span class="at">col=</span><span class="st">'blue'</span>)</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">density</span>(dat<span class="sc">$</span>alter_am_jahresende_2023), <span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="fu">age_distr</span>(kanton)</span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a><span class="co"># by gender</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a><span class="fu">age_distr</span>(<span class="fu">subset</span>(kanton, geschlecht<span class="sc">==</span><span class="st">'F'</span>), <span class="st">'weiblich'</span>)</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a><span class="fu">age_distr</span>(<span class="fu">subset</span>(kanton, geschlecht<span class="sc">==</span><span class="st">'M'</span>), <span class="st">'männlich'</span>)</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a><span class="fu">## candidate votes</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>Back to the main topic: number of votes. How many did each candidate collect?</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r votes}</span></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>kanton <span class="sc">%&gt;%</span> </span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(kandidaten_nr, parteikurzbezeichnung, bisher, gewahlt, ganzer_name, stimmen_total_aus_wahlzettel, hlv_nr) <span class="sc">%&gt;%</span> </span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(stimmen_total_aus_wahlzettel))</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>Naively one could imagine the seats go to the 4 candidates with the most votes - but that ignores</span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>the intention to try to assign seats in a fashion that mirrors the votes for lists;</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>here in Switzerland the most decisive seat distribution factor are the votes for a</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a>"Listenverbindung".</span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a><span class="fu"># Listen and Listenverbindungen</span></span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>We have 32 lists, most of them sent in 4 candidates:</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lists}</span></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(kanton<span class="sc">$</span>listen_nr, <span class="at">useNA =</span> <span class="st">'ifany'</span>)  <span class="co"># 32 lists run</span></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>(lists <span class="ot">&lt;-</span> kanton <span class="sc">%&gt;%</span> </span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(listen_nr, hlv_nr, ulv_nr, partei_id, parteikurzbezeichnung, parteibezeichnung) <span class="sc">%&gt;%</span> </span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">listenstimmen=</span><span class="fu">mean</span>(kandidatenstimmen_unveranderte_wahlzettel<span class="sc">+</span>kandidatenstimmen_veranderte_wahlzettel<span class="sc">+</span></span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>                                zusatzstimmen_unveranderte_wahlzettel<span class="sc">+</span>zusatzstimmen_veranderte_wahlzettel),</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>            <span class="at">kandidates=</span><span class="fu">n</span>()))</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>  </span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>Looking at the distinctiveness of the columns in table **lists** we see:</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r list_distinct}</span></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">sapply</span>(lists, distinctness))</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>listen_nr, parteikurzbezeichnung, and parteibezeichnung all identify uniquely the lists. </span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>What partei_id is supposed to designate escapes me, the "Datensatzschema" from https://data.bs.ch/explore/dataset/100281/information</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>does not help.</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a><span class="fu">## tree structure of Listenverbindungen</span></span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>There are Hauptlistenverbindungen and Unterlistenverbindungen, though these are not mandatory for lists,</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>they generate a tree structure with 3 major blocks competing for 4 seats.</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a>Analysis of a values in tree structures is not mainstream in R.</span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a>I employ the package **data.tree** to do so and first need to construct another column in table</span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>**lists** that indicates the position in the tree:</span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r listenverbindungen}</span></span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a><span class="co"># tree structure of the lists:</span></span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>lists<span class="sc">$</span>pathString <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">'basel'</span>,</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">coalesce</span>(lists<span class="sc">$</span>hlv_nr, <span class="st">''</span>),</span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">coalesce</span>(lists<span class="sc">$</span>ulv_nr, <span class="st">''</span>),</span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>                          lists<span class="sc">$</span>listen_nr,</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sep =</span> <span class="st">'/'</span></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a>                          )</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>zz <span class="ot">&lt;-</span> data.tree<span class="sc">::</span><span class="fu">as.Node</span>(lists)</span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(zz, <span class="st">'parteikurzbezeichnung'</span>)</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>Three lists, PdA, VA, and MV, do not belong to any Listenverbindung.</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>There are three Hauptlistenverbindungen:</span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>1 conservatives</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>2 moderate left</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>3 SVP</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>among which the seats have to be distributed.</span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a><span class="fu">### candidates per Hauptlistenverbindung</span></span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hlv_candidates}</span></span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a><span class="co"># number of candidates per Hauptliste</span></span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>zz<span class="sc">$</span><span class="fu">Do</span>( <span class="cf">function</span>(x) {</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>kandidaten_total <span class="ot">&lt;-</span> <span class="fu">Aggregate</span>(<span class="at">node =</span> x,</span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>                       <span class="at">attribute =</span> <span class="st">"kandidates"</span>,</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>                       <span class="at">aggFun =</span> sum)</span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>data.tree<span class="sc">::</span><span class="fu">Get</span>(zz<span class="sc">$</span>children, <span class="st">'kandidaten_total'</span>)</span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>Extensive use of Listenverbindungen blows up the number of candidates;</span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>Hauptlistenverbindung 1 comes with 68 of these!</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a><span class="fu"># top level votes</span></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>How many votes did the Hauptlistenverbindungen and the Einzellisten come up with?</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hlv_votes}</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a><span class="do">## top-level votes</span></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>(hl_votes <span class="ot">&lt;-</span> <span class="fu">sort</span>(data.tree<span class="sc">::</span><span class="fu">Get</span>(zz<span class="sc">$</span>children, <span class="cf">function</span>(x) data.tree<span class="sc">::</span><span class="fu">Aggregate</span>(x, <span class="st">'listenstimmen'</span>, sum)), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## seats per Hauptlistenverbindung</span></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a>First step in seat distribution is to determine the quorum:</span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>the number of votes is divided by number of seats plus 1, then the next higher</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>integer number is set as quorum.</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a>The integer part of the division of the votes of Hauptlistenverbindungen by the quorum </span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a>indicates number of seats given to the Hauplistenverbindung.</span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>It is possible that this first round does not distribute all seats - as is the case here.</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>Votes of the Hauptlistenverbindung then are divided by 1 plus number of seats received</span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>and the remaining seat goes to the Hauptlistenverbindung with the highest quotient,</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>here 1.</span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hlv_seats}</span></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a><span class="co"># 1st seat distribution</span></span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a>(quorum1 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">sum</span>(hl_votes)<span class="sc">/</span>(<span class="dv">4</span><span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a>(seats1 <span class="ot">&lt;-</span> <span class="fu">floor</span>(hl_votes<span class="sc">/</span>quorum1))</span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a><span class="co"># 2nd seat distribution</span></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(hl_votes<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>seats1), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a>Within the Hauptlistenverbindung the seats get distributed according to the same</span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a>multi-step process first to Unterlistenverbindung, then Liste.</span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a>Detailed protocols of this process are provided by the Basel Staatskanzlei, see</span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a>https://www.staatskanzlei.bs.ch/dam/jcr:302a9016-ef8c-41b8-888a-f6d7332ff1ab/Ausw_5a.pdf.</span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-236"><a href="#cb35-236" aria-hidden="true" tabindex="-1"></a>For a general picture what Swiss voters can do with their ballot paper, see</span>
<span id="cb35-237"><a href="#cb35-237" aria-hidden="true" tabindex="-1"></a>https://www.srf.ch/news/schweiz/wahlhilfe/kumulieren-und-panaschieren-so-waehlt-man-mit-listen.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>