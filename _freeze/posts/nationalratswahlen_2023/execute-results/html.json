{
  "hash": "a4cd5bf786a10a163d93eb9218de6558",
  "result": {
    "markdown": "---\ntitle: \"Nationalratswahlen Basel 2023\"\nauthor: \"Reinhold Koch\"\ndate: \"2023-10-30\"\noutput: html_document\n---\n\n\n\n\n## Nationalratswahlen Basel 2023\n\nOn 2023-10-22 Nationalratswahlen took place in Switzerland, so also in Basel.\nThe results can be seen on https://www.staatskanzlei.bs.ch/politische-rechte/wahlen-abstimmungen/wahlen-2023.html\nincluding the protocols how the 4 Basel seats in the Nationalrat were assigned.\n\nA nice open government data service are the downloadable vote counts from a link on this page. \nAs the Swiss election system is far from simple I thought it informativ to look into the vote counts\nand see whether I could compute the election results myself and see whether I arrive at the same results\nas the Basel Staatskanzlei.\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/initialise_4d53a5559e9aaee216782f05a68ae57e'}\n\n```{.r .cell-code}\nlibrary(data.tree)\nlibrary(dplyr, warn.conflicts = FALSE)\nlibrary(philentropy)\nlibrary(readxl, warn.conflicts = FALSE)\n\ndistinctness <- function(x) philentropy::H(table(x, useNA = 'ifany')/length(x)) / log(length(x), 2)\n```\n:::\n\n\n### Data download\nIf not already in the active R session, I download the Excel file containing the vote counts.\nExcel file, because it is type safe (\"01\" != 1) and provides a familiar table format.\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/download_db6f50f5f78b4bd8e799d0130f149f9b'}\n\n```{.r .cell-code}\n# read in data if not already present\nif (!exists('dat0')) {\n  download.file('https://data.bs.ch/api/explore/v2.1/catalog/datasets/100281/exports/xlsx', tf <- tempfile(fileext = '.xlsx'))\n  dat0 <- readxl::read_xlsx(tf)\n}\ndim(dat0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 610  90\n```\n:::\n:::\n\n\n### Data scrubbing\nThis is a pretty wide data table with 90 columns.\nA description of the columns can be found as \"Datensatzschema\" in the tab \"Information\" on\nhttps://data.bs.ch/explore/dataset/100281/information.\nThe first columns contain constant values, like **wahlbezeichnung** \"Wahl von vier Mitgliedern des Nationalrates\".\n\nTo find and remove such columns I employ the entropy of a column's values. \nThe **distinctness()** function defined above returns **0** for columns with constant values\nand **1** for columns that have a different value for each row in the table (row identifying columns).\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/scrub_bb885fdc0783dbda12092f764e94881f'}\n\n```{.r .cell-code}\n# determine constant columns, move them to \"general\" dataframe\nentropy0 <- sapply(dat0, distinctness)\ngeneral <- unique(dat0[,names(entropy0[entropy0==0])])\ngeneral\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"wahlbezeichnung\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"amtsdauer\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"wahltermin\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"anzahl_sitze\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ungestempelte_wahlzettel\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Wahl von vier Mitgliedern des Nationalrates\",\"2\":\"2023-2027\",\"3\":\"2023-10-22\",\"4\":\"4\",\"5\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ndat1 <- dat0[, setdiff(names(dat0), names(general))]\ndim(dat1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 610  85\n```\n:::\n:::\n\n\n## Wahlkreise\nAmong the remaining 85 columns there are 3 that identify Wahlkreise.\nI am not interested in the individual Wahlkreise (electoral district), but in\nthe \"Kanton Basel-Stadt\".\nSo I split dat1 accordingly and concentrate on this pseudo Wahlkreis.\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/wahlkreise_45bf010898a5ccf3dbd5651ee0c61a2b'}\n\n```{.r .cell-code}\n## find right Wahlkreis for Kanton\ntable(dat1$wahlkreisbezeichnung)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  Auslandschweizer Gemeinde Bettingen    Gemeinde Riehen Kanton Basel-Stadt        Stadt Basel \n               122                122                122                122                122 \n```\n:::\n\n```{.r .cell-code}\n# split dat1 by Wahlkreise\nwahlkreise <- split(dat1, dat1$wahlkreisbezeichnung)\n# concentrate on Kanton\nkanton0 <- wahlkreise[['Kanton Basel-Stadt']]\ndim(kanton0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 122  85\n```\n:::\n:::\n\n\n### scrub kanton\nThere are a number of constant columns in the kanton data table.\nLike with the original data table I move them out to a separate table.\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/scrub_kanton_9639784f3970ade73133a494f9152a1b'}\n\n```{.r .cell-code}\nentropy_kanton <- sapply(kanton0, distinctness)\nkanton_general <- unique(kanton0[,names(entropy_kanton[entropy_kanton==0])])\n\nkanton <- kanton0[, setdiff(names(kanton0), names(kanton_general))]\ndim(kanton)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 122  67\n```\n:::\n:::\n\nThe entropy shows that the candidates' name and its equivalents kandidaten_nr and personen_id uniquely\ndetermine a single row in the kanton table.\n\n### excursion: distribution of candidate ages\nJust for fun let us have a look at the distribution of the candidates' ages:\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/age_distribution_55241fdf55804471703971b8e03b7e13'}\n\n```{.r .cell-code}\n## age distribution of candidates\nage_distr <- function(dat, dataspec=NULL) {\n  hist(dat$alter_am_jahresende_2023, freq = FALSE,\n       main = paste('Altersverteilung der Kandidaten', dataspec), xlab = 'Kandidatenalter',\n       breaks = seq(15,90,5))\n  lines(density(dat$alter_am_jahresende_2023, adjust=.5), col='blue')\n  lines(density(dat$alter_am_jahresende_2023), col='red')\n}\nage_distr(kanton)\n```\n\n::: {.cell-output-display}\n![](nationalratswahlen_2023_files/figure-html/age_distribution-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# by gender\npar(mfrow=c(2,1))\nage_distr(subset(kanton, geschlecht=='F'), 'weiblich')\nage_distr(subset(kanton, geschlecht=='M'), 'männlich')\n```\n\n::: {.cell-output-display}\n![](nationalratswahlen_2023_files/figure-html/age_distribution-2.png){width=672}\n:::\n\n```{.r .cell-code}\npar(mfrow=c(1,1))\n```\n:::\n\n\n## candidate votes\nBack to the main topic: number of votes. How many did each candidate collect?\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/votes_b3c10aa058baee53258ca2125f039707'}\n\n```{.r .cell-code}\nkanton %>% \n  dplyr::select(kandidaten_nr, parteikurzbezeichnung, bisher, gewahlt, ganzer_name, stimmen_total_aus_wahlzettel, hlv_nr) %>% \n  dplyr::arrange(desc(stimmen_total_aus_wahlzettel))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"kandidaten_nr\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"parteikurzbezeichnung\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"bisher\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"gewahlt\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ganzer_name\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"stimmen_total_aus_wahlzettel\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"hlv_nr\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"0501\",\"2\":\"SP\",\"3\":\"bisher\",\"4\":\"Gewählt\",\"5\":\"Wyss, Sarah\",\"6\":\"22032\",\"7\":\"2\"},{\"1\":\"0502\",\"2\":\"SP\",\"3\":\"bisher\",\"4\":\"nicht gewählt\",\"5\":\"Atici, Mustafa\",\"6\":\"20138\",\"7\":\"2\"},{\"1\":\"0801\",\"2\":\"BGB\",\"3\":\"bisher\",\"4\":\"Gewählt\",\"5\":\"Arslan, Sibel\",\"6\":\"14239\",\"7\":\"2\"},{\"1\":\"0503\",\"2\":\"SP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Mathys, Lisa\",\"6\":\"12995\",\"7\":\"2\"},{\"1\":\"0504\",\"2\":\"SP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"von Wartburg, Christian (Guschti)\",\"6\":\"10800\",\"7\":\"2\"},{\"1\":\"0301\",\"2\":\"LDP\",\"3\":\"bisher\",\"4\":\"Gewählt\",\"5\":\"von Falkenstein, Patricia\",\"6\":\"9792\",\"7\":\"1\"},{\"1\":\"1204\",\"2\":\"SVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Thüring, Joël\",\"6\":\"8242\",\"7\":\"3\"},{\"1\":\"0802\",\"2\":\"BGB\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Vergeat, Jo\",\"6\":\"8084\",\"7\":\"2\"},{\"1\":\"1203\",\"2\":\"SVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Suter, Stefan\",\"6\":\"7366\",\"7\":\"3\"},{\"1\":\"1001\",\"2\":\"GLP\",\"3\":\"bisher\",\"4\":\"Gewählt\",\"5\":\"Christ, Katja\",\"6\":\"6655\",\"7\":\"1\"},{\"1\":\"0104\",\"2\":\"FDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Dürr, Baschi\",\"6\":\"6220\",\"7\":\"1\"},{\"1\":\"1201\",\"2\":\"SVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Block, Laetitia\",\"6\":\"6009\",\"7\":\"3\"},{\"1\":\"1202\",\"2\":\"SVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Stumpf Rutschmann, Daniela\",\"6\":\"5680\",\"7\":\"3\"},{\"1\":\"0302\",\"2\":\"LDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Furlano, Raoul\",\"6\":\"4958\",\"7\":\"1\"},{\"1\":\"0803\",\"2\":\"BGB\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Goepfert, Nicola\",\"6\":\"4766\",\"7\":\"2\"},{\"1\":\"0804\",\"2\":\"BGB\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hoppler, Laurin\",\"6\":\"3903\",\"7\":\"2\"},{\"1\":\"0701\",\"2\":\"Mitte\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Herter, Balz\",\"6\":\"3775\",\"7\":\"1\"},{\"1\":\"0303\",\"2\":\"LDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hug, Michael\",\"6\":\"3550\",\"7\":\"1\"},{\"1\":\"0304\",\"2\":\"LDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Isler-Christ, Lydia\",\"6\":\"3233\",\"7\":\"1\"},{\"1\":\"1003\",\"2\":\"GLP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Baumgartner, Claudia\",\"6\":\"2605\",\"7\":\"1\"},{\"1\":\"1002\",\"2\":\"GLP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Pekerman, Bülent\",\"6\":\"2520\",\"7\":\"1\"},{\"1\":\"0103\",\"2\":\"FDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Biland, Eva\",\"6\":\"2518\",\"7\":\"1\"},{\"1\":\"0102\",\"2\":\"FDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Barth, Johannes\",\"6\":\"2446\",\"7\":\"1\"},{\"1\":\"0704\",\"2\":\"Mitte\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Huber, Patrick\",\"6\":\"2317\",\"7\":\"1\"},{\"1\":\"0703\",\"2\":\"Mitte\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Conti, Tiziana\",\"6\":\"2241\",\"7\":\"1\"},{\"1\":\"0702\",\"2\":\"Mitte\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Knellwolf, Andrea\",\"6\":\"2195\",\"7\":\"1\"},{\"1\":\"1004\",\"2\":\"GLP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Sieber, Johannes\",\"6\":\"2160\",\"7\":\"1\"},{\"1\":\"0101\",\"2\":\"FDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Alù, Tamara\",\"6\":\"2004\",\"7\":\"1\"},{\"1\":\"0401\",\"2\":\"EVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Gysin, Brigitte\",\"6\":\"1370\",\"7\":\"1\"},{\"1\":\"0404\",\"2\":\"EVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Widmer-Huber, Thomas\",\"6\":\"1252\",\"7\":\"1\"},{\"1\":\"2801\",\"2\":\"MV\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Della Giacoma, Mario\",\"6\":\"1198\",\"7\":\"NA\"},{\"1\":\"0402\",\"2\":\"EVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hochuli, Christoph\",\"6\":\"1178\",\"7\":\"1\"},{\"1\":\"0403\",\"2\":\"EVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Stankowski, Rebecca\",\"6\":\"1099\",\"7\":\"1\"},{\"1\":\"1703\",\"2\":\"Basta-rm\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Zürcher, Tonja\",\"6\":\"1066\",\"7\":\"2\"},{\"1\":\"1101\",\"2\":\"PdA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Genitsch Gratwohl, Vera\",\"6\":\"1014\",\"7\":\"NA\"},{\"1\":\"1401\",\"2\":\"VA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Weber, Eric\",\"6\":\"908\",\"7\":\"NA\"},{\"1\":\"2103\",\"2\":\"jgb\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Girard, Fina\",\"6\":\"847\",\"7\":\"2\"},{\"1\":\"1701\",\"2\":\"Basta-rm\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Deiss, Sina\",\"6\":\"810\",\"7\":\"2\"},{\"1\":\"1402\",\"2\":\"VA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Wächter, Sascha\",\"6\":\"729\",\"7\":\"NA\"},{\"1\":\"1704\",\"2\":\"Basta-rm\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Bolliger, Oliver\",\"6\":\"708\",\"7\":\"2\"},{\"1\":\"1702\",\"2\":\"Basta-rm\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Stier, Franziska\",\"6\":\"692\",\"7\":\"2\"},{\"1\":\"2503\",\"2\":\"JGLP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Rohner, Tim\",\"6\":\"627\",\"7\":\"1\"},{\"1\":\"2404\",\"2\":\"SP60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Burckhardt, Leonhard\",\"6\":\"624\",\"7\":\"2\"},{\"1\":\"2102\",\"2\":\"jgb\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Feurer, Anouk\",\"6\":\"617\",\"7\":\"2\"},{\"1\":\"2504\",\"2\":\"JGLP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Bucher, Milena\",\"6\":\"588\",\"7\":\"1\"},{\"1\":\"2403\",\"2\":\"SP60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Baerlocher, Thomas\",\"6\":\"571\",\"7\":\"2\"},{\"1\":\"3202\",\"2\":\"GLP-K-U\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Bollack, Lukas\",\"6\":\"520\",\"7\":\"1\"},{\"1\":\"2003\",\"2\":\"JUSO\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Russano, Nino\",\"6\":\"519\",\"7\":\"2\"},{\"1\":\"3601\",\"2\":\"Mitte60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Isler, Beatrice\",\"6\":\"518\",\"7\":\"1\"},{\"1\":\"0901\",\"2\":\"EDU\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hirschi-Schiegg, Karin\",\"6\":\"518\",\"7\":\"3\"},{\"1\":\"2004\",\"2\":\"JUSO\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Schäfer, Maria Ioana\",\"6\":\"515\",\"7\":\"2\"},{\"1\":\"2701\",\"2\":\"BastA-jA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Aelen, Marvin / Doa\",\"6\":\"480\",\"7\":\"2\"},{\"1\":\"2104\",\"2\":\"jgb\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Schmidlin, Aurel\",\"6\":\"468\",\"7\":\"2\"},{\"1\":\"2001\",\"2\":\"JUSO\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Haefeli, Ella\",\"6\":\"466\",\"7\":\"2\"},{\"1\":\"1102\",\"2\":\"PdA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Goldschmidt, Matthias\",\"6\":\"466\",\"7\":\"NA\"},{\"1\":\"2802\",\"2\":\"MV\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Studinger, Maria\",\"6\":\"465\",\"7\":\"NA\"},{\"1\":\"2803\",\"2\":\"MV\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Studinger, Leo\",\"6\":\"453\",\"7\":\"NA\"},{\"1\":\"1103\",\"2\":\"PdA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hofer, Stefan\",\"6\":\"448\",\"7\":\"NA\"},{\"1\":\"2401\",\"2\":\"SP60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"König-Lüdin, Dominique\",\"6\":\"435\",\"7\":\"2\"},{\"1\":\"3604\",\"2\":\"Mitte60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Wehrle, Stefan\",\"6\":\"434\",\"7\":\"1\"},{\"1\":\"3201\",\"2\":\"GLP-K-U\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Kühne, Brigitte\",\"6\":\"430\",\"7\":\"1\"},{\"1\":\"2002\",\"2\":\"JUSO\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Portmann, David\",\"6\":\"422\",\"7\":\"2\"},{\"1\":\"2101\",\"2\":\"jgb\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Bürge, Clara\",\"6\":\"418\",\"7\":\"2\"},{\"1\":\"2702\",\"2\":\"BastA-jA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hunter, Xenia\",\"6\":\"416\",\"7\":\"2\"},{\"1\":\"2603\",\"2\":\"FDP+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Haller, Christophe\",\"6\":\"410\",\"7\":\"1\"},{\"1\":\"3501\",\"2\":\"GLP-R-E\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Rechsteiner, Niggi\",\"6\":\"400\",\"7\":\"1\"},{\"1\":\"2704\",\"2\":\"BastA-jA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Zimmermann, Mia\",\"6\":\"385\",\"7\":\"2\"},{\"1\":\"2201\",\"2\":\"JMITTE\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Brenneis-Hobi, Manuela\",\"6\":\"382\",\"7\":\"1\"},{\"1\":\"2402\",\"2\":\"SP60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Verrey, Etiennette J.\",\"6\":\"382\",\"7\":\"2\"},{\"1\":\"3603\",\"2\":\"Mitte60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Lötscher-Steiger, Bruno\",\"6\":\"371\",\"7\":\"1\"},{\"1\":\"3203\",\"2\":\"GLP-K-U\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Lienhard, Nadine Michèle\",\"6\":\"368\",\"7\":\"1\"},{\"1\":\"2502\",\"2\":\"JGLP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Kuhn, Jessica\",\"6\":\"354\",\"7\":\"1\"},{\"1\":\"2703\",\"2\":\"BastA-jA\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Krneta, Kasimir\",\"6\":\"333\",\"7\":\"2\"},{\"1\":\"2604\",\"2\":\"FDP+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Jenny, David\",\"6\":\"324\",\"7\":\"1\"},{\"1\":\"3103\",\"2\":\"SVP60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Schaller, Beat K.\",\"6\":\"320\",\"7\":\"3\"},{\"1\":\"3303\",\"2\":\"GLP-B\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Staehelin, Christine\",\"6\":\"309\",\"7\":\"1\"},{\"1\":\"3004\",\"2\":\"SVP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Schweizer-Hoffmann, Jenny\",\"6\":\"308\",\"7\":\"3\"},{\"1\":\"3302\",\"2\":\"GLP-B\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Mischke, Jürgen\",\"6\":\"302\",\"7\":\"1\"},{\"1\":\"3602\",\"2\":\"Mitte60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Strahm, Andrea\",\"6\":\"301\",\"7\":\"1\"},{\"1\":\"2601\",\"2\":\"FDP+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Schweizer, Silvia\",\"6\":\"290\",\"7\":\"1\"},{\"1\":\"3402\",\"2\":\"LDP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hettich, Daniel\",\"6\":\"288\",\"7\":\"1\"},{\"1\":\"2501\",\"2\":\"JGLP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Neuenschwander, Nicolas\",\"6\":\"280\",\"7\":\"1\"},{\"1\":\"3002\",\"2\":\"SVP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Omlin, Florian\",\"6\":\"279\",\"7\":\"3\"},{\"1\":\"1802\",\"2\":\"JSVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Hablützel, Demi\",\"6\":\"276\",\"7\":\"3\"},{\"1\":\"3204\",\"2\":\"GLP-K-U\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Vicentini, Daniel\",\"6\":\"274\",\"7\":\"1\"},{\"1\":\"3003\",\"2\":\"SVP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Schmid, Daniel\",\"6\":\"253\",\"7\":\"3\"},{\"1\":\"3101\",\"2\":\"SVP60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Herzig-Jonasch, Oskar\",\"6\":\"253\",\"7\":\"3\"},{\"1\":\"0601\",\"2\":\"JFDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Lüthy, Jonas\",\"6\":\"252\",\"7\":\"1\"},{\"1\":\"2602\",\"2\":\"FDP+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Bucher, Erich\",\"6\":\"236\",\"7\":\"1\"},{\"1\":\"2304\",\"2\":\"JLB\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"von Falkenstein, Benjamin\",\"6\":\"231\",\"7\":\"1\"},{\"1\":\"1803\",\"2\":\"JSVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Jacomet, Lucas\",\"6\":\"230\",\"7\":\"3\"},{\"1\":\"1801\",\"2\":\"JSVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Bottoni, Diandra\",\"6\":\"227\",\"7\":\"3\"},{\"1\":\"0902\",\"2\":\"EDU\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Messina, Luzian\",\"6\":\"222\",\"7\":\"3\"},{\"1\":\"3304\",\"2\":\"GLP-B\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Tasoglu, Javuz\",\"6\":\"216\",\"7\":\"1\"},{\"1\":\"3001\",\"2\":\"SVP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Nikolic, Bozidar\",\"6\":\"208\",\"7\":\"3\"},{\"1\":\"0604\",\"2\":\"JFDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Mumenthaler, Lionel\",\"6\":\"207\",\"7\":\"1\"},{\"1\":\"3301\",\"2\":\"GLP-B\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Bothe-Wenk, Sandra\",\"6\":\"206\",\"7\":\"1\"},{\"1\":\"3102\",\"2\":\"SVP60+\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Lindner, Roland\",\"6\":\"203\",\"7\":\"3\"},{\"1\":\"3401\",\"2\":\"LDP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Borer, Patrick\",\"6\":\"196\",\"7\":\"1\"},{\"1\":\"0903\",\"2\":\"EDU\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Schneider, Martin\",\"6\":\"195\",\"7\":\"3\"},{\"1\":\"1804\",\"2\":\"JSVP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Lutz, Joshua\",\"6\":\"183\",\"7\":\"3\"},{\"1\":\"3502\",\"2\":\"GLP-R-E\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Wallace, Denise\",\"6\":\"171\",\"7\":\"1\"},{\"1\":\"3503\",\"2\":\"GLP-R-E\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Francis, Jessica\",\"6\":\"163\",\"7\":\"1\"},{\"1\":\"3504\",\"2\":\"GLP-R-E\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Fernandez, Laura\",\"6\":\"161\",\"7\":\"1\"},{\"1\":\"3701\",\"2\":\"GLP-KMU\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Christ, Tobias\",\"6\":\"154\",\"7\":\"1\"},{\"1\":\"3804\",\"2\":\"GLP-I\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Häni, Thomas\",\"6\":\"152\",\"7\":\"1\"},{\"1\":\"2203\",\"2\":\"JMITTE\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Murray, Sara\",\"6\":\"145\",\"7\":\"1\"},{\"1\":\"0603\",\"2\":\"JFDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Flad, Eugénie\",\"6\":\"140\",\"7\":\"1\"},{\"1\":\"2202\",\"2\":\"JMITTE\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Natoli, Marco\",\"6\":\"139\",\"7\":\"1\"},{\"1\":\"2301\",\"2\":\"JLB\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Eberhardt, Josephine\",\"6\":\"135\",\"7\":\"1\"},{\"1\":\"0602\",\"2\":\"JFDP\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Jung, Isabel\",\"6\":\"133\",\"7\":\"1\"},{\"1\":\"2204\",\"2\":\"JMITTE\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Winkler, Kilian\",\"6\":\"128\",\"7\":\"1\"},{\"1\":\"3801\",\"2\":\"GLP-I\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Kaufmann, Wanja\",\"6\":\"125\",\"7\":\"1\"},{\"1\":\"2302\",\"2\":\"JLB\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Laissue, Marvin\",\"6\":\"113\",\"7\":\"1\"},{\"1\":\"3403\",\"2\":\"LDP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Spillmann, Daniela\",\"6\":\"103\",\"7\":\"1\"},{\"1\":\"3404\",\"2\":\"LDP-Gew\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Thüring, Yvette\",\"6\":\"100\",\"7\":\"1\"},{\"1\":\"3704\",\"2\":\"GLP-KMU\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Löw, Michael\",\"6\":\"88\",\"7\":\"1\"},{\"1\":\"3802\",\"2\":\"GLP-I\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Wilhelmi, Thomas\",\"6\":\"87\",\"7\":\"1\"},{\"1\":\"2303\",\"2\":\"JLB\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Marckwordt, Joshua\",\"6\":\"83\",\"7\":\"1\"},{\"1\":\"3702\",\"2\":\"GLP-KMU\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Meyer, Serge\",\"6\":\"79\",\"7\":\"1\"},{\"1\":\"3703\",\"2\":\"GLP-KMU\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Mathis-Stich, Sonja\",\"6\":\"79\",\"7\":\"1\"},{\"1\":\"3803\",\"2\":\"GLP-I\",\"3\":\"NA\",\"4\":\"nicht gewählt\",\"5\":\"Frey Brenner, Andrea Johanna\",\"6\":\"55\",\"7\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nNaively one could imagine the seats go to the 4 candidates with the most votes - but that ignores\nthe intention to try to assign seats in a fashion that mirrors the votes for lists;\nhere in Switzerland the most decisive seat distribution factor are the votes for a\n\"Listenverbindung\".\n\n# Listen and Listenverbindungen\nWe have 32 lists, most of them sent in 4 candidates:\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/lists_37525e96e5896dbecb2db503859c1caf'}\n\n```{.r .cell-code}\ntable(kanton$listen_nr, useNA = 'ifany')  # 32 lists run\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n01 03 04 05 06 07 08 09 10 11 12 14 17 18 20 21 22 23 24 25 26 27 28 30 31 32 33 34 35 36 37 38 \n 4  4  4  4  4  4  4  3  4  3  4  2  4  4  4  4  4  4  4  4  4  4  3  4  3  4  4  4  4  4  4  4 \n```\n:::\n\n```{.r .cell-code}\n(lists <- kanton %>% \n  group_by(listen_nr, hlv_nr, ulv_nr, partei_id, parteikurzbezeichnung, parteibezeichnung) %>% \n  summarise(listenstimmen=mean(kandidatenstimmen_unveranderte_wahlzettel+kandidatenstimmen_veranderte_wahlzettel+\n                                zusatzstimmen_unveranderte_wahlzettel+zusatzstimmen_veranderte_wahlzettel),\n            kandidates=n()))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'listen_nr', 'hlv_nr', 'ulv_nr', 'partei_id',\n'parteikurzbezeichnung'. You can override using the `.groups` argument.\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"listen_nr\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"hlv_nr\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ulv_nr\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"partei_id\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"parteikurzbezeichnung\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"parteibezeichnung\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"listenstimmen\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"kandidates\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"01\",\"2\":\"1\",\"3\":\"1\",\"4\":\"8\",\"5\":\"FDP\",\"6\":\"FDP.Die Liberalen Basel-Stadt\",\"7\":\"13489\",\"8\":\"4\"},{\"1\":\"03\",\"2\":\"1\",\"3\":\"2\",\"4\":\"15\",\"5\":\"LDP\",\"6\":\"LDP Liberal-Demokratische Partei Basel-Stadt\",\"7\":\"21948\",\"8\":\"4\"},{\"1\":\"04\",\"2\":\"1\",\"3\":\"NA\",\"4\":\"4\",\"5\":\"EVP\",\"6\":\"Evangelische Volkspartei Basel-Stadt (EVP)\",\"7\":\"4946\",\"8\":\"4\"},{\"1\":\"05\",\"2\":\"2\",\"3\":\"3\",\"4\":\"17\",\"5\":\"SP\",\"6\":\"Sozialdemokratische Partei Basel-Stadt (SP)\",\"7\":\"67502\",\"8\":\"4\"},{\"1\":\"06\",\"2\":\"1\",\"3\":\"1\",\"4\":\"18\",\"5\":\"JFDP\",\"6\":\"Jungfreisinnige Basel-Stadt\",\"7\":\"742\",\"8\":\"4\"},{\"1\":\"07\",\"2\":\"1\",\"3\":\"4\",\"4\":\"3\",\"5\":\"Mitte\",\"6\":\"Die Mitte Basel-Stadt\",\"7\":\"10674\",\"8\":\"4\"},{\"1\":\"08\",\"2\":\"2\",\"3\":\"5\",\"4\":\"3\",\"5\":\"BGB\",\"6\":\"Bündnis GRÜNE BastA!\",\"7\":\"31227\",\"8\":\"4\"},{\"1\":\"09\",\"2\":\"3\",\"3\":\"NA\",\"4\":\"21\",\"5\":\"EDU\",\"6\":\"Eidgenössisch Demokratische Union Basel-Stadt (EDU)\",\"7\":\"946\",\"8\":\"3\"},{\"1\":\"10\",\"2\":\"1\",\"3\":\"6\",\"4\":\"22\",\"5\":\"GLP\",\"6\":\"GLP - Grünliberale Partei Basel-Stadt\",\"7\":\"14280\",\"8\":\"4\"},{\"1\":\"11\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"9\",\"5\":\"PdA\",\"6\":\"Partei der Arbeit (PdA) Basel\",\"7\":\"1933\",\"8\":\"3\"},{\"1\":\"12\",\"2\":\"3\",\"3\":\"7\",\"4\":\"67\",\"5\":\"SVP\",\"6\":\"Schweizerische Volkspartei Basel-Stadt (SVP)\",\"7\":\"27740\",\"8\":\"4\"},{\"1\":\"14\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"44\",\"5\":\"VA\",\"6\":\"Volks-Aktion gegen zuviele Ausländer und Asylanten in unserer Heimat (VA) - Liste Ausländerstopp\",\"7\":\"1690\",\"8\":\"2\"},{\"1\":\"17\",\"2\":\"2\",\"3\":\"5\",\"4\":\"44\",\"5\":\"Basta-rm\",\"6\":\"Bündnis: BastA! radikal menschlich\",\"7\":\"3285\",\"8\":\"4\"},{\"1\":\"18\",\"2\":\"3\",\"3\":\"7\",\"4\":\"26\",\"5\":\"JSVP\",\"6\":\"Junge SVP Basel-Stadt (JSVP)\",\"7\":\"938\",\"8\":\"4\"},{\"1\":\"20\",\"2\":\"2\",\"3\":\"3\",\"4\":\"27\",\"5\":\"JUSO\",\"6\":\"JUSO Basel-Stadt\",\"7\":\"1925\",\"8\":\"4\"},{\"1\":\"21\",\"2\":\"2\",\"3\":\"5\",\"4\":\"28\",\"5\":\"jgb\",\"6\":\"junges grünes bündnis\",\"7\":\"2356\",\"8\":\"4\"},{\"1\":\"22\",\"2\":\"1\",\"3\":\"4\",\"4\":\"28\",\"5\":\"JMITTE\",\"6\":\"Die Junge Mitte Basel-Stadt\",\"7\":\"809\",\"8\":\"4\"},{\"1\":\"23\",\"2\":\"1\",\"3\":\"2\",\"4\":\"46\",\"5\":\"JLB\",\"6\":\"Jungliberale\",\"7\":\"569\",\"8\":\"4\"},{\"1\":\"24\",\"2\":\"2\",\"3\":\"3\",\"4\":\"46\",\"5\":\"SP60+\",\"6\":\"Sozialdemokratische Partei Basel-Stadt 60+ (SP 60+)\",\"7\":\"2024\",\"8\":\"4\"},{\"1\":\"25\",\"2\":\"1\",\"3\":\"6\",\"4\":\"47\",\"5\":\"JGLP\",\"6\":\"GLP - Junge Grünliberale\",\"7\":\"1859\",\"8\":\"4\"},{\"1\":\"26\",\"2\":\"1\",\"3\":\"1\",\"4\":\"47\",\"5\":\"FDP+\",\"6\":\"FDP PLUS\",\"7\":\"1285\",\"8\":\"4\"},{\"1\":\"27\",\"2\":\"2\",\"3\":\"5\",\"4\":\"47\",\"5\":\"BastA-jA\",\"6\":\"Bündnis: BastA! junge Alternative!\",\"7\":\"1615\",\"8\":\"4\"},{\"1\":\"28\",\"2\":\"NA\",\"3\":\"NA\",\"4\":\"47\",\"5\":\"MV\",\"6\":\"MASS-VOLL! Bewegung für Freiheit, Souveränität und Grundrechte\",\"7\":\"2163\",\"8\":\"3\"},{\"1\":\"30\",\"2\":\"3\",\"3\":\"7\",\"4\":\"47\",\"5\":\"SVP-Gew\",\"6\":\"SVP Gewerbe-Liste\",\"7\":\"1054\",\"8\":\"4\"},{\"1\":\"31\",\"2\":\"3\",\"3\":\"7\",\"4\":\"13\",\"5\":\"SVP60+\",\"6\":\"SVP 60+\",\"7\":\"922\",\"8\":\"3\"},{\"1\":\"32\",\"2\":\"1\",\"3\":\"6\",\"4\":\"13\",\"5\":\"GLP-K-U\",\"6\":\"GLP - Klima & Umwelt\",\"7\":\"1599\",\"8\":\"4\"},{\"1\":\"33\",\"2\":\"1\",\"3\":\"6\",\"4\":\"13\",\"5\":\"GLP-B\",\"6\":\"GLP - Bildung\",\"7\":\"1077\",\"8\":\"4\"},{\"1\":\"34\",\"2\":\"1\",\"3\":\"2\",\"4\":\"49\",\"5\":\"LDP-Gew\",\"6\":\"Gewerbe LDP\",\"7\":\"701\",\"8\":\"4\"},{\"1\":\"35\",\"2\":\"1\",\"3\":\"6\",\"4\":\"49\",\"5\":\"GLP-R-E\",\"6\":\"GLP - Regio & Europa\",\"7\":\"904\",\"8\":\"4\"},{\"1\":\"36\",\"2\":\"1\",\"3\":\"4\",\"4\":\"49\",\"5\":\"Mitte60+\",\"6\":\"Die Mitte Basel-Stadt 60+\",\"7\":\"1648\",\"8\":\"4\"},{\"1\":\"37\",\"2\":\"1\",\"3\":\"6\",\"4\":\"49\",\"5\":\"GLP-KMU\",\"6\":\"GLP - KMU\",\"7\":\"400\",\"8\":\"4\"},{\"1\":\"38\",\"2\":\"1\",\"3\":\"6\",\"4\":\"49\",\"5\":\"GLP-I\",\"6\":\"GLP - International\",\"7\":\"424\",\"8\":\"4\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nLooking at the distinctiveness of the columns in table **lists** we see:\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/list_distinct_ed46b64abc5355aee4ab1152189dbfb9'}\n\n```{.r .cell-code}\nsort(sapply(lists, distinctness))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           kandidates                hlv_nr                ulv_nr             partei_id \n            0.1476127             0.3406070             0.5857458             0.7751614 \n            listen_nr parteikurzbezeichnung     parteibezeichnung         listenstimmen \n            1.0000000             1.0000000             1.0000000             1.0000000 \n```\n:::\n:::\n\n\nlisten_nr, parteikurzbezeichnung, and parteibezeichnung all identify uniquely the lists. \nWhat partei_id is supposed to designate escapes me, the \"Datensatzschema\" from https://data.bs.ch/explore/dataset/100281/information\ndoes not help.\n\n## tree structure of Listenverbindungen\n\nThere are Hauptlistenverbindungen and Unterlistenverbindungen, though these are not mandatory for lists,\nthey generate a tree structure with 3 major blocks competing for 4 seats.\n\nAnalysis of a values in tree structures is not mainstream in R.\nI employ the package **data.tree** to do so and first need to construct another column in table\n**lists** that indicates the position in the tree:\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/listenverbindungen_878648b073389a7eee3cbef27084bd12'}\n\n```{.r .cell-code}\n# tree structure of the lists:\nlists$pathString <- paste('basel',\n                          dplyr::coalesce(lists$hlv_nr, ''),\n                          dplyr::coalesce(lists$ulv_nr, ''),\n                          lists$listen_nr,\n                          sep = '/'\n                          )\nzz <- data.tree::as.Node(lists)\nprint(zz, 'parteikurzbezeichnung')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        levelName parteikurzbezeichnung\n1  basel                               \n2   ¦--1                               \n3   ¦   ¦--1                           \n4   ¦   ¦   ¦--01                   FDP\n5   ¦   ¦   ¦--06                  JFDP\n6   ¦   ¦   °--26                  FDP+\n7   ¦   ¦--2                           \n8   ¦   ¦   ¦--03                   LDP\n9   ¦   ¦   ¦--23                   JLB\n10  ¦   ¦   °--34               LDP-Gew\n11  ¦   ¦--04                       EVP\n12  ¦   ¦--4                           \n13  ¦   ¦   ¦--07                 Mitte\n14  ¦   ¦   ¦--22                JMITTE\n15  ¦   ¦   °--36              Mitte60+\n16  ¦   °--6                           \n17  ¦       ¦--10                   GLP\n18  ¦       ¦--25                  JGLP\n19  ¦       ¦--32               GLP-K-U\n20  ¦       ¦--33                 GLP-B\n21  ¦       ¦--35               GLP-R-E\n22  ¦       ¦--37               GLP-KMU\n23  ¦       °--38                 GLP-I\n24  ¦--2                               \n25  ¦   ¦--3                           \n26  ¦   ¦   ¦--05                    SP\n27  ¦   ¦   ¦--20                  JUSO\n28  ¦   ¦   °--24                 SP60+\n29  ¦   °--5                           \n30  ¦       ¦--08                   BGB\n31  ¦       ¦--17              Basta-rm\n32  ¦       ¦--21                   jgb\n33  ¦       °--27              BastA-jA\n34  ¦--3                               \n35  ¦   ¦--09                       EDU\n36  ¦   °--7                           \n37  ¦       ¦--12                   SVP\n38  ¦       ¦--18                  JSVP\n39  ¦       ¦--30               SVP-Gew\n40  ¦       °--31                SVP60+\n41  ¦--11                           PdA\n42  ¦--14                            VA\n43  °--28                            MV\n```\n:::\n:::\n\n\nThree lists, PdA, VA, and MV, do not belong to any Listenverbindung.\nThere are three Hauptlistenverbindungen:\n\n* 1 conservatives\n* 2 moderate left\n* 3 SVP\n\namong which the seats have to be distributed.\n\n### candidates per Hauptlistenverbindung\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/hlv_candidates_cd9016966c606d580af1660c7c6b6017'}\n\n```{.r .cell-code}\n# number of candidates per Hauptliste\nzz$Do( function(x) {\n  x$kandidaten_total <- Aggregate(node = x,\n                       attribute = \"kandidates\",\n                       aggFun = sum)\n                  }\n     )\ndata.tree::Get(zz$children, 'kandidaten_total')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n 1  2  3 11 14 28 \n68 28 18  3  2  3 \n```\n:::\n:::\n\nExtensive use of Listenverbindungen blows up the number of candidates;\nHauptlistenverbindung 1 comes with 68 of these!\n\n# top level votes\n\nHow many votes did the Hauptlistenverbindungen and the Einzellisten come up with?\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/hlv_votes_723dd8d979825a3deed6de58aefeda4f'}\n\n```{.r .cell-code}\n## top-level votes\n(hl_votes <- sort(data.tree::Get(zz$children, function(x) data.tree::Aggregate(x, 'listenstimmen', sum)), decreasing = TRUE))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     2      1      3     28     11     14 \n109934  77354  31600   2163   1933   1690 \n```\n:::\n:::\n\n\n## seats per Hauptlistenverbindung\n\nFirst step in seat distribution is to determine the quorum:\nthe number of votes is divided by number of seats plus 1, then the next higher\ninteger number is set as quorum.\nThe integer part of the division of the votes of Hauptlistenverbindungen by the quorum \nindicates number of seats given to the Hauplistenverbindung.\n\nIt is possible that this first round does not distribute all seats - as is the case here.\nVotes of the Hauptlistenverbindung then are divided by 1 plus number of seats received\nand the remaining seat goes to the Hauptlistenverbindung with the highest quotient,\nhere 1.\n\n\n\n::: {.cell hash='nationalratswahlen_2023_cache/html/hlv_seats_9ff0f4f60ed530b7a38764c5c9cdb8f6'}\n\n```{.r .cell-code}\n# 1st seat distribution\n(quorum1 <- ceiling(sum(hl_votes)/(4+1)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 44935\n```\n:::\n\n```{.r .cell-code}\n(seats1 <- floor(hl_votes/quorum1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n 2  1  3 28 11 14 \n 2  1  0  0  0  0 \n```\n:::\n\n```{.r .cell-code}\n# 2nd seat distribution\nsort(hl_votes/(1+seats1), decreasing = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       1        2        3       28       11       14 \n38677.00 36644.67 31600.00  2163.00  1933.00  1690.00 \n```\n:::\n:::\n\n\nWithin the Hauptlistenverbindung the seats get distributed according to the same\nmulti-step process first to Unterlistenverbindung, then Liste.\n\nDetailed protocols of this process are provided by the Basel Staatskanzlei, see\nhttps://www.staatskanzlei.bs.ch/dam/jcr:302a9016-ef8c-41b8-888a-f6d7332ff1ab/Ausw_5a.pdf.\n\nFor a general picture what Swiss voters can do with their ballot paper, see\nhttps://www.srf.ch/news/schweiz/wahlhilfe/kumulieren-und-panaschieren-so-waehlt-man-mit-listen.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}